# ç³»ç»ŸéªŒè¯æŒ‡å—

è¡¨å·²é‡æ–°åˆ›å»ºï¼Œç°åœ¨éœ€è¦éªŒè¯ç³»ç»Ÿæ˜¯å¦æ­£å¸¸å·¥ä½œã€‚

## æ­¥éª¤ 1: æ£€æŸ¥æœåŠ¡çŠ¶æ€

ç¡®ä¿æœåŠ¡æ­£åœ¨è¿è¡Œï¼š

```bash
docker-compose ps
```

åº”è¯¥çœ‹åˆ° `postgres` å’Œ `backend` ä¸¤ä¸ªæœåŠ¡éƒ½åœ¨è¿è¡Œã€‚

## æ­¥éª¤ 2: éªŒè¯è¡¨ç»“æ„

åœ¨ DBeaver ä¸­æ‰§è¡Œä»¥ä¸‹ SQLï¼Œæ£€æŸ¥è¡¨ç»“æ„æ˜¯å¦æ­£ç¡®ï¼š

```sql
-- æŸ¥çœ‹è¡¨ç»“æ„
SELECT 
    column_name,
    data_type,
    character_maximum_length,
    is_nullable,
    column_default
FROM information_schema.columns
WHERE table_name = 'alerts'
ORDER BY ordinal_position;
```

åº”è¯¥çœ‹åˆ°ä»¥ä¸‹å­—æ®µï¼š
- id
- input
- enterprise_name
- time
- alert_type
- template_name
- om_type
- alert_key
- processed
- timeout_triggered
- created_at
- updated_at

## æ­¥éª¤ 3: æµ‹è¯• API

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨æµ‹è¯•è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
python test_api.py
```

### æ–¹æ³•äºŒï¼šä½¿ç”¨ API æ–‡æ¡£

1. æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š`http://localhost:8000/docs`
2. æ‰¾åˆ° `POST /api/alert` æ¥å£
3. ç‚¹å‡» "Try it out"
4. ä½¿ç”¨ä»¥ä¸‹æµ‹è¯•æ•°æ®ï¼š

```json
{
  "input": "ğŸ”´ **ã€å‘Šè­¦è§¦å‘ã€‘ç›‘æ§å‘Šè­¦**\næµ‹è¯•å‘Šè­¦å†…å®¹",
  "enterprise_name": "æµ‹è¯•ä¼ä¸š",
  "time": "2025-12-10 10:25:34",
  "alert_type": "å‘Šè­¦è§¦å‘",
  "template_name": "æµ‹è¯•æ¨¡æ¿",
  "om_type": "ConnectionRate",
  "alert_key": "test_alert_001"
}
```

5. ç‚¹å‡» "Execute"
6. åº”è¯¥è¿”å›åˆ›å»ºçš„å‘Šè­¦è®°å½•

### æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ curl

```bash
curl -X POST "http://localhost:8000/api/alert" \
  -H "Content-Type: application/json" \
  -d '{
    "input": "æµ‹è¯•å‘Šè­¦å†…å®¹",
    "enterprise_name": "æµ‹è¯•ä¼ä¸š",
    "time": "2025-12-10 10:25:34",
    "alert_type": "å‘Šè­¦è§¦å‘",
    "template_name": "æµ‹è¯•æ¨¡æ¿",
    "om_type": "ConnectionRate",
    "alert_key": "test_alert_001"
  }'
```

## æ­¥éª¤ 4: éªŒè¯æ•°æ®å†™å…¥

åœ¨ DBeaver ä¸­æ‰§è¡Œï¼š

```sql
-- æŸ¥çœ‹æœ€æ–°åˆ›å»ºçš„å‘Šè­¦
SELECT * FROM alerts ORDER BY created_at DESC LIMIT 5;

-- éªŒè¯å­—æ®µæ˜¯å¦æ­£ç¡®
SELECT 
    id,
    enterprise_name,
    alert_type,
    template_name,
    om_type,
    alert_key,
    time,
    created_at
FROM alerts
ORDER BY created_at DESC
LIMIT 1;
```

## æ­¥éª¤ 5: æµ‹è¯•æŸ¥è¯¢ API

### æŸ¥è¯¢æ‰€æœ‰å‘Šè­¦

```bash
curl http://localhost:8000/api/alerts
```

æˆ–åœ¨æµè§ˆå™¨è®¿é—®ï¼š`http://localhost:8000/api/alerts`

### æŒ‰ä¼ä¸šæŸ¥è¯¢

```bash
curl "http://localhost:8000/api/alerts?enterprise_name=æµ‹è¯•ä¼ä¸š"
```

### æŒ‰å‘Šè­¦ç±»å‹æŸ¥è¯¢

```bash
curl "http://localhost:8000/api/alerts?alert_type=å‘Šè­¦è§¦å‘"
```

## æ­¥éª¤ 6: æµ‹è¯•è¶…æ—¶æ£€æŸ¥é€»è¾‘

åˆ›å»ºä¸¤ä¸ª"å‘Šè­¦è§¦å‘"è®°å½•ï¼ŒéªŒè¯è¶…æ—¶æ£€æŸ¥é€»è¾‘ï¼š

### åˆ›å»ºç¬¬ä¸€ä¸ªå‘Šè­¦è§¦å‘

```json
{
  "input": "ç¬¬ä¸€ä¸ªå‘Šè­¦è§¦å‘",
  "enterprise_name": "æµ‹è¯•ä¼ä¸šA",
  "time": "2025-12-10 10:00:00",
  "alert_type": "å‘Šè­¦è§¦å‘",
  "template_name": "æ¨¡æ¿A",
  "om_type": "TypeA",
  "alert_key": "alert_001"
}
```

### åˆ›å»ºç¬¬äºŒä¸ªå‘Šè­¦è§¦å‘ï¼ˆç›¸åŒä¼ä¸šã€æ¨¡æ¿ã€OMç±»å‹ï¼‰

```json
{
  "input": "ç¬¬äºŒä¸ªå‘Šè­¦è§¦å‘",
  "enterprise_name": "æµ‹è¯•ä¼ä¸šA",
  "time": "2025-12-10 10:05:00",
  "alert_type": "å‘Šè­¦è§¦å‘",
  "template_name": "æ¨¡æ¿A",
  "om_type": "TypeA",
  "alert_key": "alert_002"
}
```

ç¬¬äºŒä¸ªå‘Šè­¦åº”è¯¥ä¼š"é‡ç½®"ç¬¬ä¸€ä¸ªå‘Šè­¦çš„è¶…æ—¶æ£€æŸ¥ã€‚

## æ­¥éª¤ 7: æ£€æŸ¥æ—¥å¿—

æŸ¥çœ‹åç«¯æœåŠ¡æ—¥å¿—ï¼Œç¡®è®¤æ²¡æœ‰é”™è¯¯ï¼š

```bash
docker-compose logs -f backend
```

## å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1: è¡¨ä¸å­˜åœ¨

å¦‚æœçœ‹åˆ° "table alerts does not exist" é”™è¯¯ï¼š

```bash
# é‡å¯åç«¯æœåŠ¡ï¼Œè®©è¡¨è‡ªåŠ¨åˆ›å»º
docker-compose restart backend

# æŸ¥çœ‹æ—¥å¿—ç¡®è®¤è¡¨å·²åˆ›å»º
docker-compose logs backend | grep -i "create"
```

### é—®é¢˜ 2: å­—æ®µä¸å­˜åœ¨

å¦‚æœçœ‹åˆ° "column does not exist" é”™è¯¯ï¼Œè¯´æ˜è¡¨ç»“æ„å¯èƒ½è¿˜æ˜¯æ—§çš„ã€‚éœ€è¦ï¼š

```bash
# åˆ é™¤è¡¨
docker-compose exec postgres psql -U alert_user -d alert_db -c "DROP TABLE alerts;"

# é‡å¯æœåŠ¡
docker-compose restart backend
```

### é—®é¢˜ 3: API è¿”å›é”™è¯¯

æ£€æŸ¥ï¼š
1. æœåŠ¡æ˜¯å¦è¿è¡Œï¼š`docker-compose ps`
2. æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯ï¼š`docker-compose logs backend`
3. è¯·æ±‚æ•°æ®æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼ˆæ‰€æœ‰å¿…å¡«å­—æ®µéƒ½å·²æä¾›ï¼‰

## æˆåŠŸæ ‡å¿—

âœ… æœåŠ¡æ­£å¸¸è¿è¡Œ  
âœ… è¡¨ç»“æ„æ­£ç¡®  
âœ… å¯ä»¥åˆ›å»ºå‘Šè­¦è®°å½•  
âœ… å¯ä»¥æŸ¥è¯¢å‘Šè­¦åˆ—è¡¨  
âœ… æ•°æ®æ­£ç¡®å†™å…¥æ•°æ®åº“  
âœ… æ—¥å¿—æ— é”™è¯¯ä¿¡æ¯  

å¦‚æœä»¥ä¸Šéƒ½æ­£å¸¸ï¼Œç³»ç»Ÿå°±é…ç½®å®Œæˆäº†ï¼


